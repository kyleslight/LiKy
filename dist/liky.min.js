(function(){var t=function(t){var e=function(){t&&t.prototype.init&&(this.superInit=t.prototype.init),this.init.apply(this,arguments)};if(t){var n=function(){};n.prototype=t.prototype,e.prototype=new n}return e.fn=e.prototype,e.fn.init=function(){},e.fn.parent=e,e.fn._super=e.__proto__,e.proxy=function(t){var e=this;return function(){return t.apply(e,arguments)}},e.fn.proxy=e.proxy,e.include=function(t){var n=t.included;for(var r in t)e.fn[r]=t[r];n&&n(e)},e.extend=function(t){var n=t.extended;for(var r in t)e[r]=t[r];n&&n(e)},e},e=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})};"function"!=typeof Object.create&&(Object.create=function(t){var e=function(){};return e.prototype=t,new e});var n={localCreate:function(t,e){this._checkObject(t)&&this._localRequest("CREATE",t,e)},localRead:function(t,e){this._checkObject(t)&&this._localRequest("READ",t,e)},localUpdate:function(t,e){this._checkObject(t)&&this._localRequest("UPDATE",t,e)},localDelete:function(t,e){this._checkObject(t)&&this._localRequest("DELETE",t,e)},remoteCreate:function(t,e){if(this._checkUrl())return"object"!=typeof t?void console.error("The first argument must be object"):(t=this._serialize(t),2===arguments.length&&"function"!=typeof e?void console.error("The second argument must be function"):void this._request("POST",t,e))},remoteRead:function(t,e){if(this._checkUrl()){if(2===arguments.length){if(t="object"==typeof t?"?"+this._serialize(t):"",e&&"function"!=typeof e)return void console.error("The second argument must be a function");var n=t,r=e}else if(1===arguments.length)if("function"==typeof t)var r=t;else if("object"==typeof t)var n=t;this._request("GET",n,r)}},remoteUpdate:function(t,e){if(this._checkUrl())return"object"!=typeof t?void console.error("The first argument must be object"):(t=this._serialize(t),2===arguments.length&&"function"!=typeof e?void console.error("The second argument must be function"):void this._request("PUT",t,e))},remoteDelete:function(t,e){if(this._checkUrl()){if(2===arguments.length){if(t="object"==typeof t?"?"+this._serialize(t):"",e&&"function"!=typeof e)return void console.error("The second argument must be a function");var n=t,r=e}else if(1===arguments.length)if("function"==typeof t)var r=t;else if("object"==typeof t)var n=t;this._request("DELETE",n,r)}},_checkUrl:function(){return this.$remoteUrl?!0:(console.error("No $remoteUrl, please set it in component"),!1)},_checkObject:function(t){return"object"!=typeof t?(console.error("The argument should be an object"),!1):!0},_request:function(t,e,n){var r=this,i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&(200===i.status&&n?n.call(r,JSON.parse(i.responseText)):console.warn("Request failed, status: %d",i.status))};var o={POST:this.$remoteUrl,GET:this.$remoteUrl+(e?e:""),PUT:this.$remoteUrl,DELETE:this.$remoteUrl+(e?e:"")};i.open(t,o[t],!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),"POST"===t||"PUT"===t?i.send(e):i.send()},_localRequest:function(t,e,n){var r,i={},o={CREATE:function(t){r.push(e[t]),localStorage[t]=JSON.stringify(r),i[t]=r},READ:function(t){i[t]=JSON.parse(localStorage[t])},UPDATE:function(t){var n=e[t]._id;r[n]=_content=e[t]._content,localStorage[t]=JSON.stringify(r),i[t]=r},DELETE:function(t){r.splice(e[t],1),localStorage[t]=JSON.stringify(r),i[t]=r}};for(var a in e)r=JSON.parse(localStorage[a]),o[t].call(this,a);n&&"function"==typeof n&&n.call(this,Object.create(i))},_serialize:function(t,e){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var i=e?e+"["+r+"]":r,o=t[r];n.push("object"==typeof o?this._serialize(o,i):encodeURIComponent(i)+"="+encodeURIComponent(o))}return n.join("&")},_updateState:function(t){for(var e in t)this.state[e]=t[e]}},r=new t;r.extend({createInstance:function(){var t=Object.create(this.prototype);return t.parent=this,t.createSelf.apply(t),t.initialState.apply(t,arguments),t},createClass:function(t){var e=Object.create(this);return e._records={},e.parent=this,e.fn=e.prototype=Object.create(this.prototype),e.include(t||{}),this.onCreated.apply(this),this.onInherited.call(this,e),e},addClassStatic:function(t){for(var e in t)this[e]=t[e]},getRecord:function(t){return this._records[t]},onInherited:function(){},onCreated:function(){},onRecordCreated:function(){},onRecordChanged:function(){},onRecordDestroyed:function(){}}),r.include({init:function(){},createSelf:function(){this._id||(this._id=e()),this.parent._records[this._id]=this,this.proxy(this.onCreated(this)),this.parent.onRecordCreated(this),this.state={}},initialState:function(t){return"object"!=typeof t?void console.warn("Parameter of createInstance should be an object."):(this.state=JSON.parse(JSON.stringify(t)),this.proxy(this.onStateCreated(this)),void this.proxy(this._onStateCreated(this)))},getState:function(t){return this.state[t]?this.state[t]:(console.warn("State attribute %s is not available.",t),null)},setState:function(t){if(t=t||{},"object"!=typeof t)return void console.error("Parameter of setState should be an object.");var e={};e.state={};for(var n in t)e.state[n]=this.state[n],this.state[n]=t[n];this.$dirty=!0,t&&this.parent.onRecordChanged(this,e,t),this.proxy(this.onStateChanged(this,e,t)),this.proxy(this._onStateChanged(this,e,t)),this.$dirty=!1},destroy:function(){this.proxy(this.onStateDestroyed(this)),this.proxy(this._onStateDestroyed(this)),this.onDestroyed.apply(this),this.parent.onRecordDestroyed(this),delete this.parent._records[this._id]},onCreated:function(){},onStateCreated:function(){},_onStateCreated:function(){},onStateChanged:function(){},_onStateChanged:function(){},onStateDestroyed:function(){},onDestroyed:function(){}}),r.include(n);var i=function(t,e){var n={};e=e||"";var r=t+" "+e;return n._el=document.querySelectorAll(r),n.each=function(t){if("function"!=typeof t)return n;for(var e=0;e<this._el.length;e++)t.apply(this._el[e]);return n},n.html=function(t){var e=this;return t?(e.each(function(){this.innerHTML=t}),n):e._el[0].innerHTML},n.delegate=function(t,e,r){var i=this,o=e.split(" "),a=i._el[0];return o.forEach(function(e){a.addEventListener(e,function(e){for(var n=e.target,i=a.querySelectorAll(t),o=0;o<i.length;o++){var s=i[o];if(n===s)return r.call(s,event)}},!1)}),n},n.replace=function(t){this._el[0]&&(this._el[0].outerHTML=t)},n},o=function(t,e){t=t.split("\n").map(function(t){return t.trim()}).join("").replace(/[\t\n\r]/g,"");var n,r,i=[],o=[],a=0,s=new RegExp("<([^>]*?) [^>]*lk-"+e+"=['\"]([^'\"]*)['\"][^>]*>"),c=function(t){t=t||"";var e=t.match(s),n=e?e[1]:"";r=new RegExp("<"+n+"|</"+n+">","g")},l=t;c(l),n=r.exec(l);var u=n?n.index:0;for(i.push(l.slice(0,u)),l=l.slice(u),c(l);n=r.exec(l);){var h=n[0];/<\/.*/.test(h)?o.pop():o.push(h),o.length||(i.push(l.slice(a,a=n.index+h.length)),l=l.slice(a),a=0,c(l))}return i.push(l),i},a=function(t,e){t=t.split("\n").map(function(t){return t.trim()}).join("").replace(/[\t\n\r]/g,"").replace(/"/g,"'");var n=/<(\S*?) ([^>]*)lk-if='([^\']*)'([^>]*)>(.*)<\/\1>/g,r=/<(\S*?) ([^>]*)lk-not='([^\']*)'([^>]*)>(.*)<\/\1>/g,i=/<(\S*?) [^>]*lk-for='([^\']*)'[^>]*>(.*)<\/\1>/g,a=/\{\{\{([^!][^\}\}\}]+)?\}\}\}/g,s=/\{\{([^!][^\}\}]+)?\}\}(?=[^}])/g,c=function(t){var i={"if":n,not:r},a="",s=function(t){return t.replace(i[a],function(t,n,r,i,o){i="this."+i.replace(/\{|\}/g,"");var s="<span "+r+"lk-"+("if"===a?"if":"not")+"'"+i+"'"+o+" ></span>";return"if"===a&&new Function("return "+i).apply(e)===!1?s:"not"===a&&new Function("return "+i).apply(e)!==!1?s:t})};return t=o(t,a="if").map(s).join(""),t=o(t,a="not").map(s).join("")},l=function(t,e){var n=o(t,"for");return n.map(function(t){return t?t.replace(i,function(t,n,r,o){var a=r.split(" "),s=a[0],c=a[2],u=o,h="this."+c;return e++,i.test(o)&&(u=l(o,e)),t.replace(o,function(){var t=u.replace(new RegExp("{{ *("+s+")([^}]*) *}}","g"),function(t,n,r){return"{{"+c+"[i"+e+"]"+r+"}}"});return t=t.replace(new RegExp("this.("+s+")(.*).length","g"),function(t,n,r){return"this."+c+"[i"+e+"]"+r+".length"}),'");\nfor(var i'+e+" = 0; i"+e+" < "+h+".length; i"+e+'++) {\n	s.push("'+t+'");\n}\ns.push("'})}):""}).join("")},u=function(t){return t.replace(s,function(t,e){return e?'" + handleValue(get(this, "'+e.trim()+'"), "'+t+'") + "':t})},h=function(t){return t.replace(a,function(t,e){return e?'" + handleHTML(get(this, "'+e.trim()+'"), "'+t+'") + "':t})},f='var get = function(obj, key) {return key.split(".").reduce(function(o, x) {var re = new RegExp("([^[]+)([^ ]*)"); var ox = x.match(re); var x = ox[1]; var suf = ox[2]; return (typeof o == "undefined" || o === null) ? o : eval("o[x]" + suf);}, obj);}; var handleValue = function(value, m) {if (value) {return value.replace(/>/g, "&gt;").replace(/</g, "&lt;");} return m;}; var handleHTML = function(value, m) {if (value) {return value;} return m;}; var s = [];',p='return s.join("").replace(/{{([^!][^}}]+)?}}(?=[^}])|{{{([^!][^}}}]+)?}}}/g, "").replace(/{{!/g, "{{")';return body=c(t),body='s.push("'+l(body,-1)+'");',body=u(body),body=h(body),body=f+body+p,new Function(body.replace(/[\t\n\r]/g,"")).apply(e).replace(/'/g,'"')};a.tagPair=o;var s=r.createClass({_preElInner:function(){var t=this;this._selectInScope("[lk-on]").each(function(){var n=this.getAttribute("lk-on"),r=n.replace(/ /g,"").split(";").map(function(t){return t.split(":")}),i=e();this.classList.add("le-"+i),t._eventMap[i]={ems:r,elClass:".le-"+i}}),this._selectInScope("[lk-if], [lk-not]").each(function(){var n=e();this.classList.add("lm-"+n),t._stateElMap[n]=this.outerHTML}),this._selectInScope("[lk-for]").each(function(){var n=e();this.classList.add("cs-"+n),t._controlMap[n]=this.outerHTML}),this._selectInScope("[lk-attr]").each(function(){var n=this.getAttribute("lk-attr"),r=n.replace(/ /g,"").split(";").map(function(t){return t.split(":")}),i=e();this.classList.add("kv-"+i),t._kvMap[i]={kvs:r,elClass:".kv-"+i}}),this._selectInScope("[lk-on], [lk-if], [lk-not], [lk-for], [lk-attr]").each(function(){this.setAttribute("_class",this.getAttribute("class"))}),this._elInner=this._el.html().replace(/^ +/gm,"").replace(/\n/gm,"").trim(),this._elInner=this._elInner.replace(/\{{2}([^\{\}]*)\}{2}(?=[^\}])|{{2}([^}]*)\}{2}$|\{{3}([^\{\}]*)\}{3}(?=[^\}])|{{3}([^}]*)\}{3}$/g,function(n){var r=e(),i='<span class="lm-'+r+'">'+n+"</span>";return t._stateElMap[r]=i,i}),t._el.delegate("[lk-state]","change paste input",function(){var e=this.getAttribute("lk-state"),n=this.value;"checkbox"===this.type&&(n=this.checked),"radio"===this.type&&(n=this.checked,t._selectInScope("input[name="+this.name+"][lk-state]:radio").each(function(){var e=this.getAttribute("lk-state");t.state[e]=!n})),t.state[e]=n,t.$reactive&&t._renderPassivity()})},_render:function(t){var e=this;if(this.$state=this.$state||{},t)e._renderPassivity();else{for(var n in this.state)this.$state[n]=this.state[n];var r=a(this._elInner,this.$state);this._el.html(r),this.onInitialRendered()}this._selectInScope("[lk-state]").each(function(){var n=this.getAttribute("lk-state");"undefined"!=typeof e.state[n]&&("checkbox"===this.type||"radio"===this.type?this.checked=e.state[n]:"INPUT"!==this.tagName&&(this.value=e.state[n]),t&&void 0!==t[n]&&(this.value=t[n]))});for(var n in this._kvMap){var i=this._kvMap[n];this._selectInScope(i.elClass).each(function(){var t=this;for(var n in i.kvs){var r=i.kvs[n][0],o=i.kvs[n][1];if("class"===r){var a=t.getAttribute("_class"),s=o.split(",");for(var c in s)a+=" "+e.state[s[c]];t.setAttribute("class",a)}else{var a="";t.setAttribute(r,o)}}})}},_delegateEvents:function(){var t=this;for(var e in this._eventMap){var n=this._eventMap[e].elClass,r=this._eventMap[e].ems;r.forEach(function(e){var r=e[0],i=e[1],o=/(.*\(\$index\).*)/g,a=i.replace("($index)","");return t[a]?void(o.test(i)?t._el.delegate(n,r,function(e){var n=e.target.className,r=[].indexOf.call(document.querySelectorAll("."+n),e.target);t.proxy(t[a].call(t,r))}):t._el.delegate(n,r,t.proxy(t[a]))):void console.error("Can not solve %s, create it in createClass of ViewModel",a)})}},_renderPassivity:function(){for(var t in this.state)this.$state[t]=this.state[t];for(var t in this._stateElMap){var e=a(this._stateElMap[t],this.$state);this._selectInScope(".lm-"+t).replace(e)}for(var t in this._controlMap){var e=a(this._controlMap[t],this.$state);this._selectInScope(".cs-"+t).replace(e)}},_onStateChanged:function(){this._render(arguments[2])},_selectInScope:function(t){return i(this.$el,t)},onInitialRendered:function(){}});s.addClassStatic({createComponent:function(t){var e=this.createClass();for(var n in t)e.prototype[n]=t[n];return e},bindElement:function(t,e){var n=this.createInstance(e||{});return n.$el=t,n._el=i(t),n._elInner=n._el.html(),n._eventMap={},n._stateElMap={},n._controlMap={},n._elStateMap={},n._kvMap={},n._preElInner(),n._render(),n._delegateEvents(),n}});var c=s;"undefined"!=typeof module&&"object"==typeof exports?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):this.LiKy=c}).call(function(){return this||("undefined"!=typeof window?window:global)}());